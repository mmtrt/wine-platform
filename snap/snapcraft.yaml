name: wine-platform
version: latest
version-script: cat $SNAPCRAFT_STAGE/version
summary: wine platform snap it provides WINE for snaps
description: |
 This snap creates a WINE base via content sharing to be used by other snaps that are using WINE.

grade: stable
confinement: strict
architectures:
  - build-on: amd64
  - build-on: i386

slots:
  wine-base-stable:
    content: wine-base-stable
    interface: content
    source:
      read:
      - $SNAP/bin
      - $SNAP/etc
      - $SNAP/lib
      - $SNAP/usr
      - $SNAP/opt/wine-stable

  wine-base-devel:
    content: wine-base-devel
    interface: content
    source:
      read:
      - $SNAP/bin
      - $SNAP/etc
      - $SNAP/lib
      - $SNAP/usr
      - $SNAP/opt/wine-devel

  wine-base-staging:
    content: wine-base-staging
    interface: content
    source:
      read:
      - $SNAP/bin
      - $SNAP/etc
      - $SNAP/lib
      - $SNAP/usr
      - $SNAP/opt/wine-staging

parts:
  enable-i386:
    plugin: nil
    build-attributes:
      - no-system-libraries
    override-build: |
      snapcraftctl build
      if [ "$SNAPCRAFT_ARCH_TRIPLET" = "x86_64-linux-gnu" ]; then
        dpkg --add-architecture i386
        apt update
      fi

  wine:
    plugin: nil
    build-attributes:
      - no-system-libraries
    build-packages:
      - dpkg
      - wget
    override-build: |
      snapcraftctl build

      ARCH="$(dpkg --print-architecture)"
      WINE_VER="3.0.4"
      WINE_VER_DEV="4.0"

      # set snap version
      echo "$WINE_VER-$WINE_VER_DEV" > $SNAPCRAFT_STAGE/version

      # wget and dpkg extract the wine debs
      ## supporting binaries which are arch-specific but the same filenames in both architectures so we only install the native architecture
      DEB_URLS="https://dl.winehq.org/wine-builds/ubuntu/dists/xenial/main/binary-${ARCH}/wine-stable_${WINE_VER}~xenial_${ARCH}.deb \
      https://dl.winehq.org/wine-builds/ubuntu/dists/xenial/main/binary-${ARCH}/wine-devel_${WINE_VER_DEV}~xenial_${ARCH}.deb \
      https://dl.winehq.org/wine-builds/ubuntu/dists/xenial/main/binary-${ARCH}/wine-staging_${WINE_VER_DEV}~xenial_${ARCH}.deb"

      ## wine loaders - this one is the native system architecture
      DEB_URLS="$DEB_URLS https://dl.winehq.org/wine-builds/ubuntu/dists/xenial/main/binary-${ARCH}/wine-stable-${ARCH}_${WINE_VER}~xenial_${ARCH}.deb \
      https://dl.winehq.org/wine-builds/ubuntu/dists/xenial/main/binary-${ARCH}/wine-devel-${ARCH}_${WINE_VER_DEV}~xenial_${ARCH}.deb \
      https://dl.winehq.org/wine-builds/ubuntu/dists/xenial/main/binary-${ARCH}/wine-staging-${ARCH}_${WINE_VER_DEV}~xenial_${ARCH}.deb"

      if [ "$ARCH" = "amd64" ]; then
        ## on amd64 builds we need to also bundle the i386 wine loaders
        DEB_URLS="$DEB_URLS https://dl.winehq.org/wine-builds/ubuntu/dists/xenial/main/binary-i386/wine-stable-i386_${WINE_VER}~xenial_i386.deb \
        https://dl.winehq.org/wine-builds/ubuntu/dists/xenial/main/binary-i386/wine-devel-i386_${WINE_VER_DEV}~xenial_i386.deb \
        https://dl.winehq.org/wine-builds/ubuntu/dists/xenial/main/binary-i386/wine-staging-i386_${WINE_VER_DEV}~xenial_i386.deb"
      fi

      for DEB_URL in ${DEB_URLS}; do
        DEB=$(basename "${DEB_URL}")
        echo "Downloading ${DEB_URL}..."
        wget --quiet "${DEB_URL}" -O "${SNAPCRAFT_PART_INSTALL}/${DEB}"
        echo "Unpacking ${DEB}..."
        dpkg -x "${SNAPCRAFT_PART_INSTALL}/${DEB}" ${SNAPCRAFT_PART_INSTALL}
        rm -f "${SNAPCRAFT_PART_INSTALL}/${DEB}"
      done

      # Cleanup
      for REL in wine-stable wine-devel wine-staging; do
      rm -rf ${SNAPCRAFT_PART_INSTALL}/opt/${REL}/share/applications
      rm -rf ${SNAPCRAFT_PART_INSTALL}/opt/${REL}/share/man
      done
      rm -rf ${SNAPCRAFT_PART_INSTALL}/usr/share/doc
      rm -rf ${SNAPCRAFT_PART_INSTALL}/usr/share/lintian
    after:
      - enable-i386

  wine-runtime:
    plugin: nil
    build-attributes:
      - no-system-libraries
    stage-packages:
      - libasound2
      #- libgphoto2-6
      - libgstreamer-plugins-base1.0-0
      - locales-all
      - liblcms2-2
      - libldap-2.4-2
      - libmpg123-0
      - libncurses5
      - libopenal1
      - libpcap0.8
      - libpulse0
      - libudev1
      - libxext6
      - libxml2
      - zlib1g
      #- libcapi20-3
      #- libcups2
      - libcanberra-gtk-module
      - libdbus-1-3
      - libfontconfig1
      - libfreetype6
      - libglu1-mesa
      - libgnutls30
      - libgsm1
      - libgssapi-krb5-2
      - libjpeg8
      #- libodbc1
      - libosmesa6
      - libpng12-0
      #- libsane
      - libsdl2-2.0-0
      - libtiff5
      - libv4l-0
      - libvulkan1
      - libxcomposite1
      - libxcursor1
      - libxfixes3
      - libxi6
      - libxinerama1
      - libxrandr2
      - libxrender1
      - libxslt1.1
      - libxxf86vm1
      - util-linux
      - winbind
      - samba-libs
      - on amd64:
        - libasound2:i386
        #- libgphoto2-6:i386
        - libgstreamer-plugins-base1.0-0:i386
        - locales-all:i386
        - liblcms2-2:i386
        - libldap-2.4-2:i386
        - libmpg123-0:i386
        - libncurses5:i386
        - libopenal1:i386
        - libpcap0.8:i386
        - libpulse0:i386
        - libudev1:i386
        - libxext6:i386
        - libxml2:i386
        - zlib1g:i386
        #- libcapi20-3:i386
        #- libcups2:i386
        - libcanberra-gtk-module:i386
        - libdbus-1-3:i386
        - libfontconfig1:i386
        - libfreetype6:i386
        - libglu1-mesa:i386
        - libgnutls30:i386
        - libgsm1:i386
        - libgssapi-krb5-2:i386
        - libjpeg8:i386
        #- libodbc1:i386
        - libosmesa6:i386
        - libpng12-0:i386
        #- libsane:i386
        - libsdl2-2.0-0:i386
        - libtiff5:i386
        - libv4l-0:i386
        - libvulkan1:i386
        - libxcomposite1:i386
        - libxcursor1:i386
        - libxfixes3:i386
        - libxi6:i386
        - libxinerama1:i386
        - libxrandr2:i386
        - libxrender1:i386
        - libxslt1.1:i386
        - libxxf86vm1:i386
        - winbind:i386
        - samba-libs:i386
    override-build: |
      snapcraftctl build
      rm -rf $SNAPCRAFT_PART_INSTALL/etc/init
      rm -rf $SNAPCRAFT_PART_INSTALL/etc/init.d
      rm -rf $SNAPCRAFT_PART_INSTALL/etc/logrotate.d
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/apps
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/applications
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/bug
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/doc
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/doc-base
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/debhelper
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/lintian
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/man
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/pixmaps
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/pkgconfig
      rm $SNAPCRAFT_PART_INSTALL/usr/bin/update-mime-database.real
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/ld-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libBrokenLocale-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libSegFault.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libanl-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libc-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libcidn-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libcrypt-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libdl-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libm-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libmemusage.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libnsl-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libnss_compat-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libnss_dns-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libnss_files-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libnss_hesiod-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libnss_nis-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libnss_nisplus-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libpcprofile.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libpthread-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libresolv-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/librt-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libthread_db-1.0.so
      rm $SNAPCRAFT_PART_INSTALL/lib/i386-linux-gnu/libutil-2.23.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/audit/sotruss-lib.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ANSI_X3.110.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ARMSCII-8.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ASMO_449.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/BIG5.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/BIG5HKSCS.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/BRF.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP10007.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP1125.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP1250.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP1251.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP1252.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP1253.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP1254.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP1255.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP1256.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP1257.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP1258.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP737.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP770.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP771.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP772.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP773.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP774.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP775.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CP932.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CSN_369103.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/CWI.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/DEC-MCS.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-AT-DE-A.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-AT-DE.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-CA-FR.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-DK-NO-A.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-DK-NO.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-ES-A.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-ES-S.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-ES.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-FI-SE-A.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-FI-SE.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-FR.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-IS-FRISS.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-IT.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-PT.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-UK.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EBCDIC-US.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ECMA-CYRILLIC.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EUC-CN.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EUC-JISX0213.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EUC-JP-MS.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EUC-JP.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EUC-KR.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/EUC-TW.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/GB18030.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/GBBIG5.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/GBGBK.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/GBK.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/GEORGIAN-ACADEMY.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/GEORGIAN-PS.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/GOST_19768-74.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/GREEK-CCITT.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/GREEK7-OLD.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/GREEK7.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/HP-GREEK8.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/HP-ROMAN8.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/HP-ROMAN9.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/HP-THAI8.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/HP-TURKISH8.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM037.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM038.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1004.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1008.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1008_420.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1025.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1026.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1046.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1047.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1097.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1112.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1122.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1123.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1124.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1129.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1130.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1132.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1133.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1137.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1140.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1141.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1142.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1143.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1144.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1145.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1146.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1147.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1148.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1149.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1153.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1154.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1155.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1156.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1157.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1158.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1160.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1161.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1162.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1163.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1164.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1166.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1167.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM12712.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1364.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1371.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1388.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1390.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM1399.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM16804.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM256.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM273.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM274.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM275.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM277.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM278.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM280.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM281.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM284.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM285.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM290.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM297.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM420.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM423.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM424.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM437.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM4517.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM4899.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM4909.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM4971.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM500.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM5347.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM803.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM850.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM851.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM852.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM855.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM856.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM857.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM860.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM861.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM862.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM863.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM864.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM865.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM866.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM866NAV.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM868.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM869.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM870.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM871.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM874.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM875.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM880.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM891.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM901.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM902.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM903.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM9030.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM904.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM905.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM9066.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM918.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM921.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM922.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM930.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM932.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM933.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM935.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM937.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM939.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM943.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IBM9448.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/IEC_P27-1.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/INIS-8.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/INIS-CYRILLIC.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/INIS.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISIRI-3342.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO-2022-CN-EXT.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO-2022-CN.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO-2022-JP-3.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO-2022-JP.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO-2022-KR.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO-IR-197.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO-IR-209.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO646.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-1.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-10.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-11.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-13.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-14.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-15.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-16.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-2.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-3.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-4.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-5.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-6.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-7.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-8.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-9.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO8859-9E.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO_10367-BOX.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO_11548-1.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO_2033.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO_5427-EXT.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO_5427.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO_5428.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO_6937-2.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/ISO_6937.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/JOHAB.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/KOI-8.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/KOI8-R.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/KOI8-RU.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/KOI8-T.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/KOI8-U.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/LATIN-GREEK-1.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/LATIN-GREEK.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/MAC-CENTRALEUROPE.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/MAC-IS.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/MAC-SAMI.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/MAC-UK.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/MACINTOSH.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/MIK.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/NATS-DANO.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/NATS-SEFI.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/PT154.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/RK1048.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/SAMI-WS2.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/SHIFT_JISX0213.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/SJIS.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/T.61.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/TCVN5712-1.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/TIS-620.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/TSCII.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/UHC.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/UNICODE.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/UTF-16.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/UTF-32.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/UTF-7.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/VISCII.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/libCNS.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/libGB.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/libISOIR165.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/libJIS.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/libJISX0213.so
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/i386-linux-gnu/gconv/libKSC.so
    after:
      - enable-i386

  wine-platform:
    plugin: dump
    build-attributes:
      - no-system-libraries
    source: scripts
    organize:
      'winetricks': bin/
      'zenity': bin/
      'wpfile': bin/
    stage-packages:
      - cabextract         # winetricks
      - libgdk-pixbuf2.0-0 # yad
      - libgtk-3-0         # yad
      - libnotify4         # yad
      - libnotify-bin      # sommelier
      - perl-base          # winetricks
      - shared-mime-info
      - unzip              # winetricks
      - wget               # winetricks
      - x11-xserver-utils  # sommelier
      - yad                # winetricks
    override-build: |
      snapcraftctl build
      wget --quiet "https://raw.githubusercontent.com/Winetricks/winetricks/master/src/winetricks" -O $SNAPCRAFT_PART_INSTALL/winetricks
      chmod +x $SNAPCRAFT_PART_INSTALL/winetricks
      wget http://security.ubuntu.com/ubuntu/pool/main/g/glibc/libc6_2.23-0ubuntu10_i386.deb && dpkg-deb -xv libc6_2.23-0ubuntu10_i386.deb .
      cp -r -p ./lib $SNAPCRAFT_PART_INSTALL/ && cp -r -p ./usr $SNAPCRAFT_PART_INSTALL/ && cp -r -p ./etc $SNAPCRAFT_PART_INSTALL/
      touch $SNAPCRAFT_PART_INSTALL/wpfile
      rm -rf $SNAPCRAFT_PART_INSTALL/etc/init
      rm -rf $SNAPCRAFT_PART_INSTALL/etc/init.d
      rm -rf $SNAPCRAFT_PART_INSTALL/etc/logrotate.d
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/bin/fc-*
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/bin/gtk-*
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/lib/dconf/dconf-service
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/lib/glib-networking/glib-pacrunner
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/GConf
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/aclocal
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/apport
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/apps
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/bash-completion
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/bug
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/debhelper
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/doc
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/doc-base
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/icons/Adwaita
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/icons/Humanity*
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/icons/LoginIcons
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/icons/ubuntu-mono*
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/info
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/kde4
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/lintian
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/menu
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/man
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/perl5
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/pixmaps
      rm -rf $SNAPCRAFT_PART_INSTALL/usr/share/pkgconfig
    after:
      - enable-i386
